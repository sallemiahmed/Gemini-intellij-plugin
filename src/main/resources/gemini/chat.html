<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Gemini Assistant Pro</title>
    <style>
        :root {
            --bg: #0f172a;
            --panel: #111827;
            --accent: #22d3ee;
            --text: #e5e7eb;
            --muted: #94a3b8;
        }
        body {
            margin: 0;
            font-family: "Inter", "SF Pro Display", -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: radial-gradient(circle at 20% 20%, rgba(34, 211, 238, 0.08), transparent 30%),
                        radial-gradient(circle at 80% 0%, rgba(59, 130, 246, 0.08), transparent 25%),
                        var(--bg);
            color: var(--text);
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        #header {
            padding: 12px 16px;
            background: linear-gradient(90deg, rgba(34, 211, 238, 0.2), rgba(59, 130, 246, 0.15));
            font-weight: 700;
            letter-spacing: 0.3px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        #history {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .message {
            padding: 12px 14px;
            border-radius: 12px;
            line-height: 1.5;
            white-space: pre-wrap;
            word-break: break-word;
            box-shadow: 0 6px 24px rgba(0, 0, 0, 0.15);
        }
        .user { background: rgba(255, 255, 255, 0.04); border: 1px solid rgba(255, 255, 255, 0.06); align-self: flex-end; }
        .assistant { background: var(--panel); border: 1px solid rgba(34, 211, 238, 0.2); align-self: flex-start; }
        #status { padding: 6px 16px; color: var(--muted); font-size: 12px; min-height: 20px; }
        #composer {
            border-top: 1px solid rgba(255, 255, 255, 0.06);
            padding: 12px 12px 14px;
            background: rgba(17, 24, 39, 0.95);
            backdrop-filter: blur(6px);
        }
        #composer textarea {
            width: 100%;
            height: 80px;
            resize: none;
            border-radius: 12px;
            padding: 10px 12px;
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid rgba(255, 255, 255, 0.08);
            color: var(--text);
        }
        #composer button {
            margin-top: 8px;
            padding: 10px 14px;
            border: none;
            border-radius: 10px;
            background: linear-gradient(90deg, #22d3ee, #3b82f6);
            color: #0b1021;
            font-weight: 700;
            cursor: pointer;
        }
        code {
            background: rgba(255, 255, 255, 0.08);
            padding: 2px 5px;
            border-radius: 4px;
            font-size: 0.95em;
        }
        pre {
            background: #0b1224;
            padding: 12px;
            border-radius: 10px;
            overflow-x: auto;
            border: 1px solid rgba(34, 211, 238, 0.2);
        }
    </style>
</head>
<body>
<div id="header">Gemini Assistant Pro</div>
<div id="history"></div>
<div id="status"></div>
<div id="composer">
    <textarea id="input" placeholder="Ask Gemini anything..."></textarea>
    <button id="send">Send</button>
</div>

<script>
    const historyEl = document.getElementById('history');
    const statusEl = document.getElementById('status');
    const inputEl = document.getElementById('input');
    const sendBtn = document.getElementById('send');

    function renderMarkdown(text) {
        return text
            .replace(/```(\w+)?([\s\S]*?)```/g, (_m, lang, code) => `<pre><code>${escapeHtml(code.trim())}</code></pre>`)
            .replace(/`([^`]+)`/g, (_m, code) => `<code>${escapeHtml(code)}</code>`)
            .replace(/^\s*[-*] (.*)$/gm, 'â€¢ $1')
            .replace(/\n\n/g, '<br/><br/>')
            .replace(/\n/g, '<br/>');
    }

    function escapeHtml(text) {
        return text.replace(/[&<>]/g, c => ({'&': '&amp;', '<': '&lt;', '>': '&gt;'}[c]));
    }

    function appendMessage(role, text) {
        const bubble = document.createElement('div');
        bubble.className = `message ${role}`;
        bubble.dataset.raw = text;
        bubble.innerHTML = renderMarkdown(text);
        historyEl.appendChild(bubble);
        historyEl.scrollTop = historyEl.scrollHeight;
    }

    function appendToLastAssistant(text) {
        const messages = historyEl.querySelectorAll('.assistant');
        const last = messages[messages.length - 1];
        if (last) {
            const combined = (last.dataset.raw || '') + text;
            last.dataset.raw = combined;
            last.innerHTML = renderMarkdown(combined);
        } else {
            appendMessage('assistant', text);
        }
        historyEl.scrollTop = historyEl.scrollHeight;
    }

    function sendMessage() {
        const value = inputEl.value.trim();
        if (!value) return;
        appendMessage('user', value);
        if (window.cefQuery) {
            window.cefQuery({
                request: JSON.stringify({type: 'userMessage', text: value}),
                onSuccess: () => {},
                onFailure: (_code, msg) => appendMessage('assistant', 'Failed to contact plugin host: ' + msg)
            });
        } else {
            appendMessage('assistant', 'Native bridge unavailable.');
        }
        inputEl.value = '';
    }

    sendBtn.addEventListener('click', sendMessage);
    inputEl.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            sendMessage();
        }
    });

    window.geminiChat = {
        addUser: (text) => appendMessage('user', text),
        addAssistant: (text) => appendMessage('assistant', text),
        appendAssistant: (text) => appendToLastAssistant(text),
        setStatus: (text) => statusEl.innerText = text || ''
    };
</script>
</body>
</html>
